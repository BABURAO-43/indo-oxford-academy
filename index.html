<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indo Oxford Academy</title>
  <meta name="description" content="Indo Oxford Academy — Where curiosity meets care" />
  <style>
    /* Simple clean styles (self-contained) */
    :root{
      --brand:#0b4f8a; --muted:#6b7280; --card:#ffffff;
      --bg:#f1f6fa; --radius:12px;
    }
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Arial;color:#0f1724;background:var(--bg);}
    a{color:var(--brand);text-decoration:none}
    header{background:linear-gradient(180deg,#083b6a 0,#0b4f8a 100%);color:#fff;padding:22px 18px;border-bottom-left-radius:18px;border-bottom-right-radius:18px;box-shadow:0 4px 20px rgba(11,79,138,0.08)}
    .wrap{max-width:1100px;margin:0 auto}
    .nav{display:flex;align-items:center;gap:18px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{margin:0;font-size:20px;letter-spacing:0.2px}
    .nav-links{display:flex;gap:18px;align-items:center}
    .hero{background:var(--card);margin:18px auto;padding:22px;border-radius:14px;box-shadow:0 8px 30px rgba(12,26,40,0.04)}
    .hero h2{margin:0 0 8px;font-size:26px;color:#062244}
    .buttons{display:flex;gap:12px;margin-top:14px}
    .btn{padding:10px 16px;border-radius:10px;border:0;background:var(--brand);color:#fff;cursor:pointer}
    .btn-outline{background:transparent;border:2px solid rgba(11,79,138,0.12);color:var(--brand)}
    /* Notices */
    #ioa-notices{max-width:980px;margin:18px auto;padding:0 18px}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(8,20,40,0.04)}
    .notice-item{padding:12px 0;border-bottom:1px solid #eef2f6}
    .muted{color:var(--muted)}
    /* Top-right widget */
    #ioa-user-widget{position:fixed;right:18px;top:12px;z-index:999;font-family:Inter,system-ui;}
    #ioa-user{display:none;align-items:center;gap:8px}
    #ioa-hello{background:#fff;padding:8px 10px;border-radius:8px;border:1px solid rgba(11,79,138,0.06);font-weight:600;color:var(--brand)}
    #ioa-logout{margin-left:8px;padding:8px 10px;border-radius:8px;border:0;background:var(--brand);color:#fff;cursor:pointer}
    /* mobile adjustments */
    @media(min-width:880px){ .nav-links{gap:26px} }
    footer{max-width:980px;margin:26px auto;padding:16px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <!-- top user widget (auto-updated by JS) -->
  <div id="ioa-user-widget">
    <div id="ioa-guest">
      <a href="./auth-ui.html" style="text-decoration:none;color:#fff;background:transparent;padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.14)">Login / Sign up</a>
    </div>
    <div id="ioa-user">
      <span id="ioa-hello"></span>
      <button id="ioa-logout">Logout</button>
      <a id="ioa-admin" href="./admin.html" style="display:none;margin-left:8px;padding:8px 10px;border-radius:8px;border:1px solid #fff;color:#fff;text-decoration:none;background:transparent">Admin</a>
    </div>
  </div>

  <header>
    <div class="wrap nav">
      <div class="brand">
        <img src="logo-dark.png" alt="IOA" style="height:44px;border-radius:8px;background:#fff;padding:4px">
        <div>
          <h1>Indo Oxford Academy</h1>
          <div style="font-size:12px;color:rgba(255,255,255,0.85);margin-top:4px">Where curiosity meets care — Estd. 2012</div>
        </div>
      </div>

      <nav class="nav-links" aria-label="Main">
        <a href="#home" style="color:#fff;font-weight:600">Home</a>
        <a href="#about" style="color:#fff">About</a>
        <a href="#courses" style="color:#fff">Courses</a>
        <a href="#faculty" style="color:#fff">Faculty</a>
        <a href="./auth-ui.html" style="color:#fff">Portal</a>
        <a href="#contact" style="color:#fff">Contact</a>
      </nav>
    </div>
  </header>

  <main class="wrap" id="home">
    <section class="hero" role="region" aria-label="Hero">
      <h2>Indo Oxford Academy</h2>
      <p class="muted">A nurturing space for students from Nursery to Class 10 — strong academics, values, and creativity. Blended learning, personalised attention, and experienced faculty.</p>
      <div class="buttons">
        <a class="btn" href="./auth-ui.html">Student Portal</a>
        <a class="btn btn-outline" href="#contact">Enroll Now</a>
      </div>
    </section>

    <!-- Notices (auto loaded) -->
    <section id="ioa-notices">
      <div class="card">
        <h3 style="margin:0 0 10px;color:var(--brand)">Notices</h3>
        <div id="ioa-notice-list" class="muted">Loading notices…</div>
      </div>
    </section>

    <!-- Sample: timetable or other content -->
    <section style="max-width:980px;margin:18px auto;padding:0 18px">
      <div class="card" style="margin-top:18px">
        <h3 style="margin:0 0 8px;color:var(--brand)">Student & Teacher Portal</h3>
        <p class="muted">Use the Portal link to sign in. After signing in, your name will appear at the top-right — no new page needed.</p>
        <div style="margin-top:12px">
          <strong>Quick Links</strong>
          <ul style="margin-top:8px;color:var(--muted)">
            <li><a href="#timetable">Class Timetables</a></li>
            <li><a href="#syllabus">Syllabus & Worksheets</a></li>
            <li><a href="#notices">Notices</a></li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Footer sample -->
    <footer>
      Indo Oxford Academy — Address: (Lohardaga), (835302), (Jharkhand). Phone: +91-9341192018
    </footer>
  </main>

  <!-- ======= Firebase + app logic (no build tools required) =======
       Replace below with your own config if you ever create a new project.
  -->
  <script type="module">
    // ---- Firebase config (your project's config) ----
    const firebaseConfig = {
      apiKey: "AIzaSyAIHBis4Sye1PdkbX1ENZa02_6YtJG874Y",
      authDomain: "indooxfordacademy-94000.firebaseapp.com",
      projectId: "indooxfordacademy-94000",
      storageBucket: "indooxfordacademy-94000.firebasestorage.app",
      messagingSenderId: "88109643719",
      appId: "1:88109643719:web:0bf5bb98c213ea06e0cbe2",
      measurementId: "G-C95MDD3MGN"
    };
    // -------------------------------------------------

    // import modular SDK (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, getDocs, limit, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ui refs
    const guestEl = document.getElementById('ioa-guest');
    const userWrap = document.getElementById('ioa-user');
    const helloEl = document.getElementById('ioa-hello');
    const logoutBtn = document.getElementById('ioa-logout');
    const adminLink = document.getElementById('ioa-admin');
    const noticeList = document.getElementById('ioa-notice-list');

    function showGuest(){ guestEl.style.display='block'; userWrap.style.display='none'; adminLink.style.display='none'; }
    function showUser(name, role){
      guestEl.style.display='none';
      userWrap.style.display='flex';
      helloEl.textContent = `Hi, ${ (name||'User').split(' ')[0] }`;
      if(role === 'teacher') adminLink.style.display='inline-block'; else adminLink.style.display='none';
    }

    // load latest notices
    async function loadNotices(){
      noticeList.textContent = 'Loading notices…';
      try{
        const q = query(collection(db,'notices'), orderBy('createdAt','desc'), limit(8));
        const snap = await getDocs(q);
        if(snap.empty){ noticeList.innerHTML = '<div class="muted">No notices yet.</div>'; return; }
        noticeList.innerHTML = snap.docs.map(d=>{
          const dt = d.data();
          const title = dt.title || 'Untitled';
          const body = (dt.body || '').slice(0, 300);
          const author = dt.authorName || dt.author || '';
          return `<div class="notice-item"><strong style="color:var(--brand)">${title}</strong><div style="color:#334155;margin-top:6px">${body}</div><div style="font-size:12px;color:#7b8794;margin-top:6px">${author}</div></div>`;
        }).join('');
      }catch(err){
        console.error(err);
        noticeList.textContent = 'Unable to load notices.';
      }
    }

    // auth listener
    onAuthStateChanged(auth, async (user)=>{
      if(!user){ showGuest(); loadNotices(); return; }
      try{
        const udoc = await getDoc(doc(db,'users',user.uid));
        const data = udoc.exists() ? udoc.data() : {};
        const name = data.name || user.displayName || user.email?.split('@')[0];
        const role = data.role || 'student';
        showUser(name, role);
      }catch(e){
        console.error(e);
        showUser(user.displayName || user.email?.split('@')[0], 'student');
      } finally {
        loadNotices();
      }
    });

    // logout handler
    logoutBtn.addEventListener('click', async ()=>{
      try{ await signOut(auth); } catch(e){ console.error(e); }
      // small delay for UI update
      setTimeout(()=>{ showGuest(); loadNotices(); }, 300);
    });

    // initial
    loadNotices();
  </script>
</body>
</html>
