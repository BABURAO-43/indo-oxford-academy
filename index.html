<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indo Oxford Academy — Portal</title>
  <meta name="description" content="Indo Oxford Academy student & teacher portal. Sign in to access resources." />
  <style>
    /* ---------- Theme ---------- */
    :root{
      --blue:#0b4f8a;
      --blue-600:#0c4b7f;
      --muted:#6b7280;
      --bg:#f6f8fb;
      --card:#ffffff;
      --glass: rgba(255,255,255,0.85);
      --radius:14px;
    }
    /* ---------- Reset & layout ---------- */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#f6f8fb 0%, #eef6fb 100%);
      color:#102a43;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
      padding:24px;
    }
    .container{max-width:980px;margin:0 auto}
    header.site {
      display:flex;
      gap:16px;
      align-items:center;
      background:linear-gradient(90deg,var(--blue),var(--blue-600));
      color:#fff;
      padding:18px;
      border-radius:var(--radius);
      box-shadow: 0 12px 30px rgba(11,23,40,0.12);
    }
    .brand {
      display:flex;align-items:center;gap:12px;
    }
    .logo-wrap{width:56px;height:56px;border-radius:10px;flex:0 0 56px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center}
    .logo-wrap img{display:block;width:100%;height:100%;object-fit:cover}
    .title {font-weight:700;font-size:18px;letter-spacing:0.1px}
    .tagline{font-size:12px;opacity:0.95;margin-top:2px}
    nav.menu{margin-left:auto}
    nav.menu button{background:transparent;border:1px solid rgba(255,255,255,0.14);color:rgba(255,255,255,0.95);padding:8px 12px;border-radius:8px;cursor:pointer}
    /* ---------- Content ---------- */
    main{margin-top:18px;display:grid;grid-template-columns: 1fr;gap:18px}
    @media(min-width:900px){ main{grid-template-columns: 1fr 420px} }

    .card{
      background:var(--card);
      border-radius:14px;
      padding:18px;
      box-shadow: 0 10px 30px rgba(8,20,40,0.06);
      overflow:hidden;
    }

    .hero h2{margin:0;font-size:20px;color:var(--blue)}
    .hero p{color:var(--muted);margin-top:8px}

    .btn{
      display:inline-block;padding:10px 14px;border-radius:10px;background:var(--blue);color:#fff;border:0;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(11,23,40,0.08);
    }
    .btn.ghost{background:transparent;color:var(--blue);border:1px solid var(--blue)}
    .btn.small{padding:8px 10px;font-size:14px;border-radius:8px}

    .media-box{
      margin-top:14px;border-radius:10px;padding:14px;background:linear-gradient(180deg,#f3fbff, #ffffff);
      min-height:140px;display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:600;
    }

    /* ---------- Form UI ---------- */
    .auth-wrap{display:flex;flex-direction:column;gap:12px}
    label{display:block;margin-bottom:6px;font-weight:600;color:#243447;font-size:14px}
    input[type="text"],input[type="password"],input[type="email"]{
      width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef6;background:#fbfeff;
      outline: none;font-size:14px;color:#0b2a3b;
      transition:box-shadow .18s, transform .1s;
    }
    input:focus{box-shadow:0 6px 20px rgba(11,23,40,0.06);transform:translateY(-1px)}
    .row{display:flex;gap:10px;align-items:center}
    .muted{color:var(--muted);font-size:13px}

    .status{margin-top:8px;padding:8px 10px;border-radius:10px;background:#f0f7ff;color:var(--blue);font-weight:600}

    /* small helpers */
    .small{font-size:13px;color:var(--muted)}
    .divider{height:1px;background:#eef4f8;margin:12px 0;border-radius:4px}

    /* footer */
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <!-- header -->
    <header class="site" role="banner" aria-label="Indo Oxford header">
      <div class="brand">
        <div class="logo-wrap" aria-hidden="true">
          <!-- try to load repo asset /logo.png first, fallback to inline svg -->
          <img id="logoImg" src="/logo.png" alt="Indo Oxford Academy logo"
               onerror="this.onerror=null; this.parentNode.innerHTML = (`
                 <svg width=56 height=56 viewBox='0 0 56 56' xmlns='http://www.w3.org/2000/svg' role='img' aria-label='logo'>
                   <rect width='56' height='56' rx='10' fill='#0b4f8a'/>
                   <text x='50%' y='52%' font-size='10' font-family='Inter, Arial' fill='#fff' text-anchor='middle' dominant-baseline='middle'>INDO</text>
                 </svg>
               `)"/>
        </div>
        <div>
          <div class="title">Indo Oxford Academy</div>
          <div class="tagline">Where curiosity meets care — Estd. 2012</div>
        </div>
      </div>

      <nav class="menu" role="navigation" aria-label="main menu">
        <button onclick="window.open('/', '_self')">Home</button>
      </nav>
    </header>

    <!-- main -->
    <main>
      <!-- left: hero + notices + timetable -->
      <section>
        <div class="card hero" aria-labelledby="heroTitle">
          <h2 id="heroTitle">A nurturing school for Nursery to Class 10</h2>
          <p>Strong academics, values and creativity. Personal attention in small batches with activity-driven learning.</p>

          <div style="margin-top:14px">
            <button class="btn" onclick="window.open('/auth-ui.html','_self')">Student Portal</button>
            <button class="btn ghost" style="margin-left:10px" onclick="window.open('https://www.youtube.com/channel/UC...', '_blank')">YouTube channel</button>
          </div>

          <div class="media-box" role="region" aria-label="School highlight">
            <!-- if you want autoplay video later, embed iframe here -->
            School Highlights — Video / Image
          </div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin:0;color:var(--blue)">Notices</h3>
          <div id="notices" style="margin-top:10px" class="small muted">Loading notices...</div>
        </div>

        <div class="card" style="margin-top:14px">
          <h3 style="margin:0;color:var(--blue)">Sample Class Timetable — Class 6</h3>
          <div style="margin-top:12px;overflow:auto">
            <table style="width:100%;border-collapse:collapse">
              <thead>
                <tr style="color:var(--muted)">
                  <th style="text-align:left;padding:8px">Time</th>
                  <th style="text-align:left;padding:8px">Mon</th>
                  <th style="text-align:left;padding:8px">Tue</th>
                  <th style="text-align:left;padding:8px">Wed</th>
                  <th style="text-align:left;padding:8px">Thu</th>
                  <th style="text-align:left;padding:8px">Fri</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding:8px">9:00 - 9:40</td>
                  <td style="padding:8px">Math</td><td style="padding:8px">Science</td><td style="padding:8px">English</td><td style="padding:8px">Computer</td><td style="padding:8px">EVS</td>
                </tr>
                <tr>
                  <td style="padding:8px">9:45 - 10:25</td>
                  <td style="padding:8px">Science</td><td style="padding:8px">Math</td><td style="padding:8px">Social</td><td style="padding:8px">Math</td><td style="padding:8px">Drawing</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- right: auth card -->
      <aside>
        <section class="card" aria-labelledby="authTitle">
          <h3 id="authTitle" style="margin:0;color:var(--blue)">Portal — Sign in / Sign up</h3>
          <div class="muted small" style="margin-top:6px">Access learning materials and announcements</div>

          <div style="height:12px"></div>

          <div class="auth-wrap" role="form" aria-label="authentication form">
            <div>
              <label for="fullname">Full name</label>
              <input id="fullname" type="text" placeholder="Your full name" autocomplete="name" />
            </div>

            <div>
              <label for="email">Email</label>
              <input id="email" type="email" placeholder="name@example.com" autocomplete="email" />
            </div>

            <div>
              <label for="password">Password</label>
              <input id="password" type="password" placeholder="Password (min 6)" autocomplete="new-password" />
            </div>

            <div class="row" style="margin-top:6px">
              <button id="btnSignup" class="btn">Create account</button>
              <button id="btnSignupTeacher" class="btn ghost">Sign up as Teacher</button>
            </div>

            <div class="divider"></div>

            <div>
              <label for="signinEmail">Email</label>
              <input id="signinEmail" type="email" placeholder="Email for sign in" />
            </div>
            <div>
              <label for="signinPassword">Password</label>
              <input id="signinPassword" type="password" placeholder="Password" />
            </div>

            <div class="row" style="margin-top:8px">
              <button id="btnSignin" class="btn small">Sign in</button>
              <button id="btnGoogle" class="btn ghost small" style="margin-left:8px">Sign in with Google</button>
            </div>

            <div id="status" class="status" aria-live="polite">Not signed in</div>
            <div id="consoleLog" class="small muted" style="margin-top:8px">Console log will appear here.</div>
          </div>
        </section>

        <div style="height:14px"></div>

        <div class="card">
          <h4 style="margin:0;color:var(--blue)">Contact</h4>
          <div class="muted small" style="margin-top:8px">Principal: +91 9128116022</div>
          <div class="muted small" style="margin-top:6px">Location: 23.409633, 84.670359 — <a href="https://www.google.com/maps?q=23.409633,84.670359" target="_blank">Open in Maps</a></div>
        </div>
      </aside>
    </main>

    <footer>
      © Indo Oxford Academy — Built with care
    </footer>
  </div>

  <!-- Firebase SDK and auth logic -->
  <script type="module">
    // ---------- REPLACE firebaseConfig with your project's config if needed ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAIHBis4Sye1PdkbX1ENZa02_6YtJG874Y",
      authDomain: "indooxfordacademy-94000.firebaseapp.com",
      projectId: "indooxfordacademy-94000",
      storageBucket: "indooxfordacademy-94000.firebasestorage.app",
      messagingSenderId: "88109643719",
      appId: "1:88109643719:web:0bf5bb98c213ea06e0cbe2",
      measurementId: "G-C95MDD3MGN"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
      GoogleAuthProvider, signInWithPopup, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Elements
    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('consoleLog');
    const noticesEl = document.getElementById('notices');

    function log(...args){ logEl.textContent = String(args.join(' ')); console.log(...args); }
    function setStatus(t){ statusEl.textContent = t; }

    // Sign up function — stores role: student|teacher
    async function signUpAs(role){
      try{
        setStatus('Creating account...');
        const name = document.getElementById('fullname').value.trim() || 'NoName';
        const email = document.getElementById('email').value.trim();
        const pwd = document.getElementById('password').value;
        if(!email || !pwd) return setStatus('Please enter email & password');
        const userCred = await createUserWithEmailAndPassword(auth, email, pwd);
        const uid = userCred.user.uid;
        await setDoc(doc(db, 'users', uid), { name, email, role, createdAt: new Date().toISOString() });
        setStatus('Account created. Logged in as ' + name);
        log('user created', uid, role);
      }catch(e){
        console.error(e); setStatus('Error: ' + (e.message || e));
      }
    }

    // Sign in
    async function signIn(){
      try{
        setStatus('Signing in...');
        const email = document.getElementById('signinEmail').value.trim();
        const pwd = document.getElementById('signinPassword').value;
        if(!email || !pwd) return setStatus('Enter email & password');
        await signInWithEmailAndPassword(auth, email, pwd);
        setStatus('Signed in');
      }catch(e){
        console.error(e); setStatus('Error: ' + (e.message || e));
      }
    }

    // Google sign-in
    async function googleSign(){
      try{
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const udocRef = doc(db, 'users', user.uid);
        const udoc = await getDoc(udocRef);
        if(!udoc.exists()){
          await setDoc(udocRef, { name: user.displayName || '', email: user.email, role: 'student' });
        }
        setStatus('Signed in with Google: ' + user.email);
      }catch(e){
        console.error(e); setStatus('Error: ' + (e.message || e));
      }
    }

    // Auth state change — greet user and show admin link if teacher
    onAuthStateChanged(auth, async (user) => {
      if(user){
        const udoc = await getDoc(doc(db, 'users', user.uid));
        const role = udoc.exists() ? udoc.data().role : 'student';
        setStatus(`Hello ${udoc.exists()?udoc.data().name:user.email} — role: ${role}`);
        if(role === 'teacher'){
          // append admin link if not already present
          if(!document.getElementById('adminLink')){
            const a = document.createElement('a');
            a.id = 'adminLink';
            a.href = './admin.html';
            a.textContent = ' Open Admin';
            a.className = 'btn ghost small';
            a.style.display = 'inline-block';
            a.style.marginTop = '8px';
            document.querySelector('.auth-wrap').appendChild(a);
          }
        }
      } else {
        setStatus('Not signed in');
      }
    });

    // Notices loader (temporary demo)
    async function loadNoticesDemo(){
      try{
        // Demo static notices — replace with dynamic firestore fetch if you want
        const demo = [
          {title:'Divisibility Test', body:'Make home work'},
          {title:'Yess', body:'Hii'}
        ];
        noticesEl.innerHTML = demo.map(n => `<div style="margin-bottom:10px"><strong style="color:var(--blue)">${n.title}</strong><div class="small muted">${n.body}</div></div>`).join('');
      }catch(e){
        noticesEl.textContent = 'Could not load notices';
      }
    }

    // attach events
    document.getElementById('btnSignup').addEventListener('click', ()=> signUpAs('student'));
    document.getElementById('btnSignupTeacher').addEventListener('click', ()=> signUpAs('teacher'));
    document.getElementById('btnSignin').addEventListener('click', signIn);
    document.getElementById('btnGoogle').addEventListener('click', googleSign);

    // initialize small UI pieces
    loadNoticesDemo();
    log('auth-ui loaded');

    // debug helpers available on window
    window._auth = auth;
    window._db = db;
  </script>

  <!-- small non-module fallback for quick debug -->
  <script>
    // ensure small click logs
    document.getElementById('btnSignup')?.addEventListener('click', ()=> console.log('SIGNUP clicked'));
  </script>
</body>
</html>
