<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indo Oxford Academy — Login</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#0b4f8a; --accent:#ffb703; --bg:#f3f7fb;
      --card:#ffffff; --muted:#6b7280; --radius:14px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#f7fbfe 0%,var(--bg) 100%);color:#0b2130}
    .container{max-width:920px;margin:28px auto;padding:18px}
    .topbar{display:flex;align-items:center;gap:12px}
    .logo{height:56px;width:56px;border-radius:12px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 20px rgba(11,23,40,0.06)}
    .brand-title{font-size:20px;font-weight:700;color:var(--brand)}
    .subtitle{font-size:13px;color:var(--muted);margin-top:2px}

    .grid{display:grid;grid-template-columns:1fr;gap:18px;margin-top:18px}
    @media(min-width:880px){ .grid{grid-template-columns: 420px 1fr} }

    .card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:0 10px 30px rgba(11,23,40,0.06)}
    h1{margin:0;font-size:20px;color:var(--brand)}
    label{display:block;margin:12px 0 6px;font-weight:600;color:#334155}
    input{width:100%;padding:12px;border-radius:10px;border:1px solid #e6eef6;background:#fbfeff}
    .row{display:flex;gap:10px;align-items:center}
    button{background:var(--brand);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    .btn-outline{background:transparent;color:var(--brand);border:1.5px solid var(--brand)}
    .small{padding:8px 10px;border-radius:8px;font-size:14px}
    .muted{color:var(--muted);font-size:14px}
    .links a{color:var(--brand);display:inline-block;margin-right:8px}

    .meta{font-size:13px;color:var(--muted);margin-top:10px}

    /* Notice preview */
    .notice{padding:12px;border-radius:10px;border:1px dashed #e8f0fb;background:linear-gradient(90deg,#fff,#fbfdff)}
    .status{margin-top:8px;color:var(--brand);font-weight:700}

    /* footer */
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="logo">
        <img id="logoImg" src="./logo-light.png" alt="Logo" style="max-width:100%;height:auto">
      </div>
      <div>
        <div class="brand-title">Indo Oxford Academy</div>
        <div class="subtitle">Where curiosity meets care — Estd. 2012</div>
      </div>
    </div>

    <div class="grid">
      <!-- left: auth -->
      <section class="card">
        <h1>Welcome — Sign in or Create account</h1>
        <div class="muted meta">Use your school account. Teachers use teacher signup (special role).</div>

        <div style="margin-top:16px">
          <h3 style="margin:0 0 8px">Create account</h3>
          <label>Full name</label>
          <input id="fullname" placeholder="Your full name" />
          <label>Email</label>
          <input id="email" placeholder="email@example.com" />
          <label>Password</label>
          <input id="password" type="password" placeholder="Password (min 6)" />

          <div style="margin-top:12px" class="row">
            <button id="btnSignup" class="small">Sign up — Student</button>
            <button id="btnSignupTeacher" class="small btn-outline">Sign up — Teacher</button>
          </div>
        </div>

        <hr style="margin:18px 0;border:none;border-top:1px solid #eef6fb" />

        <div>
          <h3 style="margin:0 0 8px">Sign in</h3>
          <label>Email</label>
          <input id="signinEmail" />
          <label>Password</label>
          <input id="signinPassword" type="password" />

          <div style="margin-top:12px" class="row">
            <button id="btnSignin" class="small">Sign in</button>
            <button id="btnGoogle" class="small btn-outline">Sign in with Google</button>
          </div>

          <div id="status" class="status" aria-live="polite">Not signed in</div>
          <div id="consoleLog" style="margin-top:10px;font-size:13px;color:#334155"></div>
        </div>
      </section>

      <!-- right: preview + contact -->
      <aside>
        <div class="card">
          <h3 style="margin:0 0 8px">Quick preview</h3>
          <div class="notice">
            <strong>Notice:</strong>
            <div id="noticeText" style="margin-top:6px">Loading latest public notice…</div>
            <div style="margin-top:8px" class="muted">After signing in, teacher accounts will see admin links.</div>
          </div>

          <div style="margin-top:12px" class="links">
            <a href="./index.html">Open School Home</a> • <a href="#contact">Contact</a>
          </div>

          <div style="margin-top:12px" class="muted">
            For best results: upload <code>logo-light.png</code> to repository root (or update path).
          </div>
        </div>

        <div class="card" style="margin-top:12px">
          <h4 style="margin:0 0 8px">School</h4>
          <div class="muted">Indo Oxford Academy, Lohardaga • Principal: +91-9128116022</div>
          <div style="margin-top:10px"><a href="https://www.youtube.com/watch?v=byPiWJ2Obpc" target="_blank" class="links">YouTube: Raw material as a fresh child</a></div>
        </div>
      </aside>
    </div>

    <footer>© Indo Oxford Academy — All rights reserved.</footer>
  </div>

  <!-- Firebase SDKs -->
  <script type="module">
    // ---- UPDATE THIS firebaseConfig with your project's config if needed ----
    const firebaseConfig = {
      apiKey: "AIzaSyAIHBis4Sye1PdkbX1ENZa02_6YtJG874Y",
      authDomain: "indooxfordacademy-94000.firebaseapp.com",
      projectId: "indooxfordacademy-94000",
      storageBucket: "indooxfordacademy-94000.firebasestorage.app",
      messagingSenderId: "88109643719",
      appId: "1:88109643719:web:0bf5bb98c213ea06e0cbe2",
      measurementId: "G-C95MDD3MGN"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, getDocs, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('consoleLog');
    const noticeText = document.getElementById('noticeText');

    function log(...args){ logEl.textContent = String(args.join(' ')); console.log(...args); }
    function setStatus(t){ statusEl.textContent = t; }

    async function signUpAs(role){
      try{
        setStatus('Creating account...');
        const name = document.getElementById('fullname').value.trim() || 'NoName';
        const email = document.getElementById('email').value.trim();
        const pwd = document.getElementById('password').value;
        if(!email || !pwd) return setStatus('Please enter email & password');
        const userCred = await createUserWithEmailAndPassword(auth, email, pwd);
        const uid = userCred.user.uid;
        await setDoc(doc(db, 'users', uid), { name, email, role });
        setStatus('Account created. Logged in as ' + name);
        log('user created', uid, role);
      }catch(e){
        console.error(e);
        setStatus('Error: ' + e.message);
      }
    }

    async function signIn(){
      try{
        setStatus('Signing in...');
        const email = document.getElementById('signinEmail').value.trim();
        const pwd = document.getElementById('signinPassword').value;
        if(!email || !pwd) return setStatus('Enter email & password');
        await signInWithEmailAndPassword(auth, email, pwd);
        setStatus('Signed in');
      }catch(e){
        console.error(e); setStatus('Error: ' + e.message);
      }
    }

    async function googleSign(){
      try{
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const udoc = await getDoc(doc(db, 'users', user.uid));
        if(!udoc.exists()){
          await setDoc(doc(db, 'users', user.uid), { name: user.displayName || '', email: user.email, role: 'student' });
        }
        setStatus('Signed in with Google: ' + user.email);
      }catch(e){
        console.error(e); setStatus('Error: ' + e.message);
      }
    }

    onAuthStateChanged(auth, async (user)=>{
      if(user){
        const udoc = await getDoc(doc(db, 'users', user.uid));
        const role = udoc.exists() ? udoc.data().role : 'student';
        setStatus(`Hello ${udoc.exists()?udoc.data().name:user.email} — role: ${role}`);
        if(role === 'teacher'){
          const a = document.createElement('a');
          a.href = './admin.html';
          a.textContent = ' Open Admin (teacher)';
          a.style.marginLeft='10px';
          a.className='btn-outline';
          document.querySelector('.card').appendChild(a);
        }
      } else {
        setStatus('Not signed in');
      }
    });

    document.getElementById('btnSignup').addEventListener('click', ()=> signUpAs('student'));
    document.getElementById('btnSignupTeacher').addEventListener('click', ()=> signUpAs('teacher'));
    document.getElementById('btnSignin').addEventListener('click', signIn);
    document.getElementById('btnGoogle').addEventListener('click', googleSign);

    // show latest public notice (read-only)
    (async function loadNotice(){
      try{
        const q = query(collection(db,'notices'), orderBy('createdAt','desc'), limit(1));
        const snap = await getDocs(q);
        if(snap.empty){ noticeText.textContent = 'No public notices yet.'; return; }
        snap.forEach(d=>{
          const data = d.data();
          noticeText.textContent = (data.title ? data.title + ' — ' : '') + (data.body||'');
        });
      }catch(e){
        console.warn('notice load failed', e);
        noticeText.textContent = 'Unable to load notices.';
      }
    })();

    // expose for debugging
    window._auth = auth; window._db = db;
    console.log('auth-ui loaded');
  </script>
</body>
</html>
