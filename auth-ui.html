<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Indo Oxford Academy — Login</title>
  <style>
    :root{--blue:#0b4f8a;--muted:#6b7280}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:0;background:#f6f8fb;color:#102a43}
    .wrap{max-width:820px;margin:36px auto;padding:20px}
    header h1{margin:0;font-size:22px;color:var(--blue)}
    .card{background:#fff;border-radius:10px;padding:18px;margin-top:18px;box-shadow:0 6px 18px rgba(8,20,40,0.06)}
    label{display:block;margin:10px 0 6px;font-weight:600;color:#334155}
    input{width:100%;padding:10px;border-radius:6px;border:1px solid #e6eef6}
    .row{display:flex;gap:10px;align-items:center}
    button{background:var(--blue);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
    .btn-outline{background:transparent;color:var(--blue);border:1px solid var(--blue)}
    .muted{color:var(--muted);font-size:14px}
    .links{margin-top:12px}
    #status{margin-top:12px;color:#0b4f8a;font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Indo Oxford Academy — Login</h1>
      <div class="muted">Sign in to access portal & resources</div>
    </header>

    <section class="card" id="authCard">
      <h3>Sign up (new)</h3>
      <label>Full name</label>
      <input id="fullname" placeholder="Full name" />
      <label>Email</label>
      <input id="email" placeholder="email@example.com" />
      <label>Password</label>
      <input type="password" id="password" placeholder="Password (min 6)" />

      <div style="margin-top:12px;" class="row">
        <button id="btnSignup">Sign up</button>
        <button id="btnSignupTeacher" class="btn-outline">Sign up as Teacher</button>
      </div>

      <hr style="margin:16px 0" />
      <h3>Sign in</h3>
      <label>Email</label><input id="signinEmail" />
      <label>Password</label><input type="password" id="signinPassword" />
      <div style="margin-top:12px;" class="row">
        <button id="btnSignin">Sign in</button>
        <button id="btnGoogle" class="btn-outline">Sign in with Google</button>
      </div>

      <div id="status" class="muted"></div>
      <div id="consoleLog" style="margin-top:10px;font-size:13px;color:#334155"></div>
    </section>
  </div>

  <!-- Firebase modular SDKs -->
  <script type="module">
    // ---- REPLACE THIS firebaseConfig object with your project's config ----
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOURS",
      authDomain: "REPLACE_WITH_YOURS.firebaseapp.com",
      projectId: "REPLACE_WITH_YOURS",
      storageBucket: "REPLACE_WITH_YOURS.appspot.com",
      messagingSenderId: "REPLACE_WITH_YOURS",
      appId: "REPLACE_WITH_YOURS",
      measurementId: "REPLACE_WITH_YOURS"
    };
    // ---------------------------------------------------------------------

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
             GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const statusEl = document.getElementById('status');
    const logEl = document.getElementById('consoleLog');
    function log(...args){ logEl.textContent = String(args.join(' ')); console.log(...args); }
    function setStatus(t){ statusEl.textContent = t; }

    async function signUpAs(role){
      try{
        setStatus('Creating account...');
        const name = document.getElementById('fullname').value.trim() || 'NoName';
        const email = document.getElementById('email').value.trim();
        const pwd = document.getElementById('password').value;
        if(!email || !pwd) return setStatus('Please enter email & password');
        const userCred = await createUserWithEmailAndPassword(auth, email, pwd);
        const uid = userCred.user.uid;
        await setDoc(doc(db, 'users', uid), { name, email, role });
        setStatus('Account created. Logged in as ' + (name));
        log('user created', uid, role);
      }catch(e){
        console.error(e);
        setStatus('Error: ' + e.message);
      }
    }

    async function signIn(){
      try{
        setStatus('Signing in...');
        const email = document.getElementById('signinEmail').value.trim();
        const pwd = document.getElementById('signinPassword').value;
        if(!email || !pwd) return setStatus('Enter email & password');
        await signInWithEmailAndPassword(auth, email, pwd);
        setStatus('Signed in');
      }catch(e){
        console.error(e); setStatus('Error: ' + e.message);
      }
    }

    async function googleSign(){
      try{
        const provider = new GoogleAuthProvider();
        const result = await signInWithPopup(auth, provider);
        const user = result.user;
        const udoc = await getDoc(doc(db, 'users', user.uid));
        if(!udoc.exists()){
          await setDoc(doc(db, 'users', user.uid), { name: user.displayName || '', email: user.email, role: 'student' });
        }
        setStatus('Signed in with Google: ' + user.email);
      }catch(e){
        console.error(e); setStatus('Error: ' + e.message);
      }
    }

    onAuthStateChanged(auth, async (user)=>{
      if(user){
        const udoc = await getDoc(doc(db, 'users', user.uid));
        const role = udoc.exists() ? udoc.data().role : 'student';
        setStatus(`Hello ${udoc.exists()?udoc.data().name:user.email} — role: ${role}`);
        if(role === 'teacher'){
          const a = document.createElement('a');
          a.href = './admin.html';
          a.textContent = ' Open Admin (teacher)';
          a.style.marginLeft='10px';
          a.className='btn-outline';
          document.getElementById('authCard').appendChild(a);
        }
      } else {
        setStatus('Not signed in');
      }
    });

    document.getElementById('btnSignup').addEventListener('click', ()=> signUpAs('student'));
    document.getElementById('btnSignupTeacher').addEventListener('click', ()=> signUpAs('teacher'));
    document.getElementById('btnSignin').addEventListener('click', signIn);
    document.getElementById('btnGoogle').addEventListener('click', googleSign);

    // expose for debugging
    window._auth = auth;
    window._db = db;
    console.log('auth-ui module loaded');
  </script>

  <!-- small debug fallback (temporary) -->
  <script>
    const btn = document.getElementById('btnSignup');
    if(btn) btn.addEventListener('click', ()=> console.log('DEBUG: btnSignup clicked'));
  </script>
</body>
</html>

